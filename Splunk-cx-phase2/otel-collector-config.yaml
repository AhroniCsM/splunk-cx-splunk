receivers:
  # File Log Receiver - reads from shared log file (ONE source!)
  filelog:
    include:
      - /var/log/myapp/application.log
    start_at: beginning
    include_file_path: true
    include_file_name: false
    operators:
      - type: regex_parser
        regex: '^(?P<timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2},\d{3}) - (?P<logger>\S+) - (?P<level>\w+) - (?P<message>.*)'
        timestamp:
          parse_from: attributes.timestamp
          layout: '%Y-%m-%d %H:%M:%S,%f'
      - type: move
        from: attributes.message
        to: body
      - type: add
        field: attributes.application
        value: "MyApp-Phase2"

processors:
  batch:
    timeout: 10s
    send_batch_size: 100

  resource:
    attributes:
      - key: environment
        value: production
        action: upsert
      - key: phase
        value: "2"
        action: upsert

  # Add attributes to logs
  attributes:
    actions:
      - key: collector
        value: otel-phase2
        action: insert

exporters:
  # Splunk HEC Exporter - forward to Splunk Cloud
  splunk_hec/logs:
    token: "${SPLUNK_HEC_TOKEN}"
    endpoint: "https://your-instance.splunkcloud.com:8088"
    source: "phase2-otel"
    sourcetype: "otel:phase2:final"
    index: "main"
    disable_compression: false
    timeout: 10s
    tls:
      insecure_skip_verify: true

  # Coralogix Exporter
  coralogix:
    domain: "${CORALOGIX_DOMAIN}"
    private_key: "${CORALOGIX_PRIVATE_KEY}"
    application_name: MyApp-Phase2-Dual
    subsystem_name: MyApp-Phase2-Dual
    timeout: 30s

  # Debug exporter for debugging
  debug:
    verbosity: normal
    sampling_initial: 5
    sampling_thereafter: 200

service:
  pipelines:
    logs:
      receivers: [filelog]  # Read from ONE log file (Shipper #2)
      processors: [batch, resource, attributes]
      exporters: [coralogix, debug]  # Coralogix only (Splunk via Python shipper)

  telemetry:
    logs:
      level: info
